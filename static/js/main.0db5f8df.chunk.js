(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t){String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");var n=t.length*e;for(e=Math.floor(Math.log(e)/Math.log(2));e;)t+=t,e--;return t+=t.substring(0,n-t.length)})},112:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(41),i=n.n(c),r=n(1),s=(n(57),n(58),"d7f0997e6cee4c4cbb08090b33ab11fe"),u="https://jildertvenema.github.io/spotify-friends-app",l="user-top-read playlist-modify-public",f=n(3),p=n(42),d=n.n(p),m=n(11),h=n.n(m),g=o.a.createContext({}),b="https://api.spotify.com/v1/",y=function(e){var t=e.auth,n=e.children,c=Object(a.useState)(d()("https://spotify-friend-backend.herokuapp.com")),i=Object(r.a)(c,1)[0],s=Object(a.useState)(!1),u=Object(r.a)(s,2),l=u[0],p=u[1],m=Object(a.useState)(""),y=Object(r.a)(m,2),j=y[0],O=y[1],v=Object(a.useState)(""),E=Object(r.a)(v,2),w=E[0],k=E[1],S=Object(a.useState)(""),C=Object(r.a)(S,2),N=C[0],_=C[1],W=Object(a.useState)([]),x=Object(r.a)(W,2),R=(x[0],x[1]),I=function(e){R(function(t){return[e].concat(Object(f.a)(t))})},A=function(e){return I("Fetch "+e),new Promise(function(n){h.a.get(b+e,{headers:{Authorization:"".concat(t.token_type," ").concat(t.access_token),"Content-Type":"application/json",Accept:"application/json"}}).then(function(t){I("resolved "+e),n(t.data)}).catch(function(t){I("Error "+e+" "+JSON.stringify(t))})})};return Object(a.useEffect)(function(){A("me").then(function(e){I("Resolved setting data /me "+JSON.stringify(e)),_(e.id),k(e.images&&e.images[0]&&e.images[0].url),O(e.display_name||"my friend"),i.emit("set-name",{name:e.display_name||"my friend"})}).catch(function(e){throw I("Error /me"),Error(e)})},[]),i.on("connect",function(e){console.log("connected",i.id),p(!0)}),i.on("event",function(e){}),i.on("disconnect",function(){}),console.log(j,w),o.a.createElement(g.Provider,{value:{auth:t,fetchSpotify:A,postSpotify:function(e,n){return new Promise(function(a){h.a.post(b+e,n,{headers:{Authorization:"".concat(t.token_type," ").concat(t.access_token),"Content-Type":"application/json",Accept:"application/json"}}).then(function(e){return a(e.data)})})},putSpotify:function(e,n){return new Promise(function(a){h.a.put(b+e,n,{headers:{Authorization:"".concat(t.token_type," ").concat(t.access_token),"Content-Type":"application/json",Accept:"application/json"}}).then(function(e){return a(e.data)})})},socket:i,displayName:j,image:w,userId:N}},l&&j?n:"Loading..")},j=n(51),O=n(10),v=n.n(O),E=n(12),w=n.n(E),k=n(48),S=function(e){O.store.addNotification({message:e,type:"success",insert:"top",container:"top-right",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],className:"notification",dismiss:{duration:3e3}})};var C=function(){var e=Object(a.useContext)(g),t=e.fetchSpotify,n=e.socket,c=e.displayName,i=e.postSpotify,s=(e.userId,e.putSpotify),u=Object(a.useState)({}),l=Object(r.a)(u,2),p=(l[0],l[1]),d=Object(a.useState)([]),m=Object(r.a)(d,2),h=(m[0],m[1]),b=Object(a.useState)([]),y=Object(r.a)(b,2),O=y[0],v=y[1],E=Object(a.useState)([]),C=Object(r.a)(E,2),N=C[0],_=C[1],W=Object(a.useState)(""),x=Object(r.a)(W,2),R=x[0],I=x[1],A=Object(a.useState)(40),M=Object(r.a)(A,1)[0],P=Object(a.useState)(!1),F=Object(r.a)(P,2),$=F[0],z=F[1],J=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("friendcode")&&localStorage.getItem("friendCode");Object(a.useEffect)(function(){t("me/top/artists").then(function(e){console.log(e);var t={},a=[];e.items.forEach(function(e){e.genres.forEach(function(e){t[e]=(t[e]||0)+1}),a.push({name:e.name,id:e.id})}),J?(console.log("friendCode",J),n.emit("connect-friend",{id:J,displayName:c,spotify:{artists:a,genres:t}},function(e){console.log("connected",e),I(e.friendName)})):n.emit("set-data",{spotify:{artists:a,genres:t}},function(e){console.log("succes setting data",e)})}),n.on("friend-playlist",function(e){var n=e.friendPlaylist,a=e.displayName;Object.keys(n.artistWeights).forEach(function(e){n.artistWeights[e]=Math.pow(n.artistWeights[e],2)}),console.log(n.artistWeights,n.genreWeights);var o=Object.keys(n.artistWeights).reduce(function(e,t){return e+n.artistWeights[t]},0);console.log("totalWeigth",o);var c=Object.keys(n.artistWeights).map(function(e){return{id:e,amount:Math.round(M/1.5/o*n.artistWeights[e])}}).filter(function(e){return e.amount>0}),i=Object.keys(n.genreWeights).reduce(function(e,t){return e+n.genreWeights[t]},0),r=Object.keys(n.genreWeights).map(function(e){return{id:e,amount:Math.round(M/2/i*n.genreWeights[e])}}).filter(function(e){return e.amount>0});console.log(c,r),c.forEach(function(e){t("artists/".concat(e.id,"/top-tracks?country=NL&limit=").concat(e.amount)).then(function(t){v(function(n){return[].concat(Object(f.a)(n),Object(f.a)(t.tracks.slice(0,e.amount)))})})}),r.forEach(function(e){t("search?query=".concat(e.id,"&type=track&market=NL&offset=0&limit=").concat(e.amount)).then(function(t){_(function(n){return[].concat(Object(f.a)(n),Object(f.a)(t.tracks.items.slice(0,e.amount)))})})}),p(r),h(c),I(a)})},[]),Object(a.useEffect)(function(){n.on("set-done",function(e){s("playlists/".concat(e.id,"/followers")),z(e)})},[]);var L="https://jildertvenema.github.io/spotify-friends-app?friendCode="+n.id;console.log(O,N);var T=[].concat(Object(f.a)(O),Object(f.a)(N));return $?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,"Done!"),o.a.createElement(w.a,{onClick:function(){return window.location=$.uri}},"Open PlayList")):o.a.createElement("div",null,O.length>0&&!J&&o.a.createElement(w.a,{onClick:function(){var e={name:"My friend Playlist with ".concat(R),description:"Generated playlist based on shared interest with ".concat(R,"."),public:!0};i("me/playlists",e).then(function(e){console.log(e);var t=T.map(function(e){return e.uri});i("playlists/".concat(e.id,"/tracks"),{uris:t}).then(function(){z(e),n.emit("done",e)})}),console.log(e)}},"Create playlist"),R&&o.a.createElement("div",null,"Connected with ",R),O.length>0&&o.a.createElement(k.a,{className:"data-table",data:T.map(function(e){return Object(j.a)({},e,{artistsNames:e.artists.map(function(e){return e.name}).join("\t")})}),columns:[{title:"Artists",dataName:"artistsNames"},{title:"Name",dataName:"name"}]}),!J&&0===T.length&&o.a.createElement(o.a.Fragment,null,"Send this link to your friend: ",L,o.a.createElement("br",null),o.a.createElement(w.a,{onClick:function(){return function(e){var t=document.createElement("input");t.value=e,t.style.opacity="0",document.body.append(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.remove(),S("Copied url to clipboard!")}(L)}},"Copy link")),J&&!R&&o.a.createElement(o.a.Fragment,null,"Connecting with ",J))};var N=function(e,t,n){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=Object.keys(e);return n.reduce(function(a,o,c){var i="".concat(a).concat(o,"=").concat(e[o]);return c<n.length-1&&(i+=t),i},"")}({client_id:e,scope:t,redirect_uri:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("friendCode")?n+"?friendcode=1":n,response_type:"token"});return"https://accounts.spotify.com/authorize?".concat(a)};function _(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}n(108);var W=n(45),x=n(46),R=n(49),I=n(47),A=n(50),M=function(e){function t(e){var n;return Object(W.a)(this,t),(n=Object(R.a)(this,Object(I.a)(t).call(this,e))).state={hasError:!1,error:null},n}return Object(A.a)(t,e),Object(x.a)(t,[{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){return this.state.hasError?o.a.createElement("div",null,o.a.createElement("h1",null,"Something went wrong."),JSON.stringify(this.state.error)):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}}]),t}(o.a.Component);n(109);n(110).polyfill(),n(111),i.a.render(o.a.createElement(M,null,o.a.createElement(v.a,null),o.a.createElement(function(){var e=Object(a.useState)(null),t=Object(r.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)(function(){var e=_("access_token"),t=_("token_type"),n=_("friendCode");n&&localStorage.setItem("friendCode",n),e&&t&&c({access_token:e,token_type:t})},[]),o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"login-modal"}),o.a.createElement("h1",null,"Spotify Friend playlist generator"),n?o.a.createElement(y,{auth:n},o.a.createElement(C,null)):o.a.createElement("button",{className:"spotify-button",onClick:function(){var e=N(s,l,u);window.location.replace(e)}},"Login with Spotify"))},null)),document.getElementById("root"))},52:function(e,t,n){e.exports=n(112)},57:function(e,t,n){},87:function(e,t){}},[[52,1,2]]]);
//# sourceMappingURL=main.0db5f8df.chunk.js.map